/*! pixtulate.js 04-04-2014 */
function pixtulate(domainName,modifyURL,constrainDimensions){domainName=domainName?"http://"+domainName+".api.pixtulate.com/":domainName;for(var type,w,h,pct_w,pct_h,viewportDPR=window.devicePixelRatio||1,viewportW=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,viewportH=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,url=domainName||"http://demo.api.pixtulate.com/",mod_url=modifyURL||!1,constrain=constrainDimensions||!1,images=document.images,img=document.getElementsByTagName("img"),placeholder="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC",device=navigator.userAgent,i=0,len=images.length;len>i;i++)if(null!==img[i].getAttribute("data-src")){var imgCW,imgCH,newSrc,origSrc=img[i].getAttribute("data-src")||img[i].src;if(mod_url&&origSrc.indexOf("://")>-1){var regex=/(\.\w+\/)/g,r=origSrc.match(regex),a=origSrc.indexOf(r),b=a+r[0].length,c=origSrc.substr(0,b);newSrc=origSrc.replace(c,url)}else-1===origSrc.indexOf("://")?(newSrc=url,newSrc+=origSrc):newSrc=origSrc;var parent=img[i].parentNode;if(null!==parent&&"BODY"!==parent.nodeName?(imgCW=img[i].getAttribute("width"),img[i].getAttribute("width")||img[i].getAttribute("height")?imgCH=img[i].getAttribute("height"):device.indexOf("MSIE 8.0")>-1?(type=parent.currentStyle.width||parent.currentStyle.height,type.indexOf("em")>-1?(w=16*parseInt(parent.currentStyle.width),h=16*parseInt(parent.currentStyle.height),imgCW=img[i].getAttribute("width")||w,imgCH=img[i].getAttribute("height")||h):type.indexOf("%")>-1?(pct_w=parseInt(parent.currentStyle.width),pct_h=parseInt(parent.currentStyle.height),w=pct_w/100*document.documentElement.clientWidth,h=pct_h/100*document.documentElement.clientWidth,imgCW=img[i].getAttribute("width")||parseInt(w),imgCH=img[i].getAttribute("height")||parseInt(h)):(imgCW=img[i].getAttribute("width")||parseInt(parent.currentStyle.width),imgCH=img[i].getAttribute("height")||parseInt(parent.currentStyle.height))):(imgCW=img[i].getAttribute("width")||parseInt(window.getComputedStyle(parent).getPropertyValue("width")),imgCH=img[i].getAttribute("height")||parseInt(window.getComputedStyle(parent).getPropertyValue("height")))):device.indexOf("MSIE 8.0")>-1&&"string"==typeof img[i].getAttribute("class")?(type=img[i].currentStyle.width||img[i].currentStyle.height,type.indexOf("em")>-1?(w=16*parseInt(img[i].currentStyle.width),h=16*parseInt(img[i].currentStyle.height),imgCW=w||img[i].getAttribute("width"),imgCH=h||img[i].getAttribute("height")):type.indexOf("%")>-1?(pct_w=parseInt(img[i].currentStyle.width),pct_h=parseInt(img[i].currentStyle.height),w=pct_w/100*document.documentElement.clientWidth,h=pct_h/100*document.documentElement.clientWidth,imgCW=parseInt(w)||img[i].getAttribute("width"),imgCH=parseInt(h)||img[i].getAttribute("height")):(imgCW=parseInt(img[i].currentStyle.width)||img[i].getAttribute("width"),imgCH=parseInt(img[i].currentStyle.height)||img[i].getAttribute("height"))):"string"==typeof img[i].getAttribute("class")?(imgCW=parseInt(window.getComputedStyle(img[i]).getPropertyValue("width"))||img[i].getAttribute("width"),imgCH=parseInt(window.getComputedStyle(img[i]).getPropertyValue("height"))||img[i].getAttribute("height")):(imgCW=constrain?img[i].getAttribute("width")||viewportW:img[i].getAttribute("width"),imgCH=constrain?img[i].getAttribute("height")||viewportH:img[i].getAttribute("height")),newSrc.indexOf("?")>-1){var regexW=/w=(\d+)/gi,regexH=/h=(\d+)/gi,regexDPR=/dpr=(\d+)/gi,matchesW=newSrc.match(regexW),matchesH=newSrc.match(regexH),matchesDPR=newSrc.match(regexDPR),paramW=matchesW||imgCW,paramH=matchesH||imgCH,paramDPR=matchesDPR||viewportDPR;!matchesW&&paramW>0&&(newSrc+="&w="+paramW),!matchesH&&paramH>0&&(newSrc+="&h="+paramH),matchesDPR||(newSrc+="&dpr="+paramDPR),newSrc+="&viewport_width="+viewportW+"&viewport_height="+viewportH,img[i].src=newSrc}else imgCW>0&&(newSrc+="?w="+imgCW),imgCH>0&&imgCW>0?newSrc+="&h="+imgCH:imgCH>0&&!imgCW&&(newSrc+="?h="+imgCH),imgCH>0||imgCW>0?newSrc+="&dpr="+viewportDPR:imgCW||imgCH||(newSrc+="?dpr="+viewportDPR),newSrc+="&viewport_width="+viewportW+"&viewport_height="+viewportH,img[i].src=newSrc;-1===newSrc.indexOf("api.pixtulate")&&(img[i].src=placeholder)}}